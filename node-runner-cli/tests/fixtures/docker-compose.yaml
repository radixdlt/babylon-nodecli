---
services:
  core:
    cap_add:
    - NET_ADMIN
    environment:
      JAVA_OPTS: --enable-preview -server -Xms8g -Xmx8g  -XX:MaxDirectMemorySize=2048m
        -XX:+HeapDumpOnOutOfMemoryError -XX:+UseCompressedOops -Djavax.net.ssl.trustStore=/etc/ssl/certs/java/cacerts
        -Djavax.net.ssl.trustStoreType=jks -Djava.security.egd=file:/dev/urandom -DLog4jContextSelector=org.apache.logging.log4j.core.async.AsyncLoggerContextSelector
      RADIXDLT_API_PORT: 3333
      RADIXDLT_GENESIS_DATA_FILE: /home/radixdlt/genesis_data_file.bin
      RADIXDLT_LOG_LEVEL: info
      RADIXDLT_NETWORK_ID: 33
      RADIXDLT_NETWORK_SEEDS_REMOTE: radix://node_tdx_c_1qvmhdlpvu3ym369ehjcmnmuam79vhs03gv0nqwhusewmvnjlfth3jpgr5ga@54.229.1.127,radix://node_tdx_c_1qfz58amtc2x8jz33uzfj9ymn8t2thhuatrt9w67he2w9x2f6eve4g20qctn@15.206.142.82,radix://node_tdx_c_1qtvxv7259j0l48gycv0zdze6he56c5sx4vjhljc7jsgkxaamnf3kccv4k4w@3.234.147.175,radix://node_tdx_c_1q2axr7xr4utg3a7hxstxdfjd7udqxzp5dqf6vgg0d0krmyrvzw775xa6nu4@3.24.207.200
      RADIXDLT_NETWORK_USE_PROXY_PROTOCOL: 'false'
      RADIXDLT_SIGN_ENABLE: 'true'
      RADIXDLT_TRANSACTIONS_API_ENABLE: 'true'
      RADIXDLT_VALIDATOR_KEY_LOCATION: /home/radixdlt/node-keystore.ks
      RADIX_NODE_KEYSTORE_PASSWORD: radix
    image: radixdlt/babylon-node:rcnet-v1.2-7742181
    init: true
    mem_limit: 12000m
    restart: unless-stopped
    ulimits:
      memlock: -1
      nofile:
        hard: 65536
        soft: 65536
    volumes:
    - core_ledger:/home/radixdlt/RADIXDB
    - /home/radixdlt/node-config/node-keystore.ks:/home/radixdlt/node-keystore.ks
    - /home/radixdlt/genesis_data_file.bin:/home/radixdlt/genesis_data_file.bin
  data_aggregator:
    cpus: 2.0
    depends_on:
    - database_migrations
    environment:
      ASPNETCORE_URLS: http://*:80
      ConnectionStrings__NetworkGatewayReadWrite: Host=host.docker.internal:5432;Database=radixdlt_ledger;Username=postgres;Password=postgres
      DataAggregator__Network__CoreApiNodes__0__CoreApiAddress: http://core:3333
      DataAggregator__Network__CoreApiNodes__0__Enabled: 'true'
      DataAggregator__Network__CoreApiNodes__0__Name: Core
      DataAggregator__Network__CoreApiNodes__0__TrustWeighting: '1'
      DataAggregator__Network__DisableCoreApiHttpsCertificateChecks: 'false'
      DataAggregator__Network__NetworkName: enkinet
      PrometheusMetricsPort: '1234'
    extra_hosts:
    - host.docker.internal:host-gateway
    image: radixdlt/babylon-ng-data-aggregator:rcnet-v1-60c8637
    ports:
    - 127.0.0.1:5208:80
    - 127.0.0.1:1234:1234
    restart: unless-stopped
  database_migrations:
    environment:
      ConnectionStrings__NetworkGatewayMigrations: Host=host.docker.internal:5432;Database=radixdlt_ledger;Username=postgres;Password=postgres
    extra_hosts:
    - host.docker.internal:host-gateway
    image: radixdlt/babylon-ng-database-migrations:rcnet-v1-60c8637
  gateway_api:
    environment:
      ASPNETCORE_URLS: http://*:80
      ConnectionStrings__NetworkGatewayReadOnly: Host=host.docker.internal:5432;Database=radixdlt_ledger;Username=postgres;Password=postgres
      ConnectionStrings__NetworkGatewayReadWrite: Host=host.docker.internal:5432;Database=radixdlt_ledger;Username=postgres;Password=postgres
      EnableSwagger: 'true'
      GatewayApi__Endpoints_MaxPageSize: '30'
      GatewayApi__Network__CoreApiNodes__0__CoreApiAddress: http://core:3333
      GatewayApi__Network__CoreApiNodes__0__Enabled: 'true'
      GatewayApi__Network__CoreApiNodes__0__Name: Core
      GatewayApi__Network__CoreApiNodes__0__RequestWeighting: '1'
      GatewayApi__Network__DisableCoreApiHttpsCertificateChecks: 'false'
      GatewayApi__Network__NetworkName: enkinet
      PrometheusMetricsPort: '1235'
    extra_hosts:
    - host.docker.internal:host-gateway
    image: radixdlt/babylon-ng-gateway-api:rcnet-v1-60c8637
    ports:
    - 127.0.0.1:5207:80
    - 127.0.0.1:1235:1235
    restart: unless-stopped
  nginx:
    environment:
      RADIXDLT_GATEWAY_API_ENABLE: 'true'
      RADIXDLT_GATEWAY_BEHIND_AUTH: 'true'
      RADIXDLT_NETWORK_USE_PROXY_PROTOCOL: 'false'
      RADIXDLT_TRANSACTIONS_API_ENABLE: 'true'
    image: radixdlt/babylon-nginx:1.0.0-rc2
    ports:
    - 443:443
    - 30000:30000
    restart: unless-stopped
    ulimits:
      nofile:
        hard: 65536
        soft: 65536
    volumes:
    - nginx_secrets:/etc/nginx/secrets
version: '2.4'
volumes:
  core_ledger:
    driver: local
    driver_opts:
      device: /home/radixdlt/data
      o: bind
      type: none
  nginx_secrets: